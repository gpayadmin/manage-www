(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-77463372","chunk-77463372","chunk-1e256628"],{"0228":function(e,t,a){"use strict";var s=a("70999"),r=a.n(s);r.a},2122:function(e,t,a){},"290e":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{width:e.modalWidth,visible:e.visible,title:"部门搜索",confirmLoading:e.confirmLoading,cancelText:"关闭",wrapClassName:"ant-modal-cust-warp"},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[[a("a-form",{attrs:{form:e.form}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"上级部门"}},[a("a-tree",{attrs:{multiple:"",treeCheckable:"tree",checkable:"",expandedKeys:e.expandedKeysss,checkedKeys:e.checkedKeys,allowClear:"true",checkStrictly:!0,dropdownStyle:{maxHeight:"200px",overflow:"auto"},treeData:e.departTree,placeholder:"请选择上级部门"},on:{expand:e.onExpand,check:e.onCheck}})],1)],1)]],2)},r=[],i=a("88bc"),d=a.n(i),l=a("0fea"),n=a("4ec3"),o=a("418f"),c={name:"DepartNewWindow",components:{userModal:o["default"]},data:function(){return{checkedKeys:[],expandedKeysss:[],userId:"",model:{},userDepartModel:{userId:"",departIdList:[]},departList:[],modalWidth:400,departTree:[],title:"操作",visible:!1,labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},confirmLoading:!1,headers:{},form:this.$form.createForm(this),url:{userId:"/sys/user/generateUserId"}}},methods:{add:function(e,t){this.checkedKeys=e,this.userId=t,this.edit({})},edit:function(e){var t=this;this.departList=[],this.queryDepartTree(),this.form.resetFields(),this.visible=!0,this.model=Object.assign({},e);var a=d()(this.model,"id","userId","departIdList");this.$nextTick((function(){t.form.setFieldsValue(a)}))},close:function(){this.$emit("close"),this.visible=!1,this.departList=[],this.checkedKeys=[]},handleSubmit:function(){var e=this,t=this;this.form.validateFields((function(a){if(!a)if(t.confirmLoading=!0,null==e.userId)Object(l["d"])(e.url.userId).then((function(a){if(a.success){var s={userId:a.result,departIdList:e.departList};t.$emit("ok",s)}})).finally((function(){t.departList=[],t.confirmLoading=!1,t.close()}));else{var s={userId:e.userId,departIdList:e.departList};t.departList=[],t.$emit("ok",s),t.confirmLoading=!1,t.close()}}))},handleCancel:function(){this.close()},onCheck:function(e,t){this.departList=[],this.checkedKeys=e.checked;for(var a=t.checkedNodes,s=0;s<a.length;s++){var r=a[s].data.props,i={key:"",value:"",title:""};i.key=r.value,i.value=r.value,i.title=r.title,this.departList.push(i)}},queryDepartTree:function(){var e=this;Object(n["K"])().then((function(t){if(t.success&&(e.departTree=t.result,e.checkedKeys&&e.checkedKeys.length>0)){var a=[],s=t.result;s&&s.length>0&&(s.forEach((function(e){a.push(e.key)})),e.expandedKeysss=a)}}))},onExpand:function(e){this.expandedKeysss=e},modalFormOk:function(){}}},u=c,h=(a("a02c"),a("2877")),p=Object(h["a"])(u,s,r,!1,null,"8d29efb4",null);t["default"]=p.exports},"42a6":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-drawer",{staticStyle:{height:"100%",overflow:"auto","padding-bottom":"53px"},attrs:{title:e.title,maskClosable:!1,width:e.drawerWidth,placement:"right",closable:!0,visible:e.visible},on:{close:e.handleCancel}},[a("template",{slot:"title"},[a("div",{staticStyle:{width:"100%"}},[a("span",[e._v(e._s(e.title))]),a("span",{staticStyle:{display:"inline-block",width:"calc(100% - 51px)","padding-right":"10px","text-align":"right"}},[a("a-button",{staticStyle:{height:"20px",width:"20px",border:"0px"},attrs:{icon:"appstore"},on:{click:e.toggleScreen}})],1)])]),a("a-spin",{attrs:{spinning:e.confirmLoading}},[a("a-form",{attrs:{form:e.form}},[a("a-form-item",{attrs:{label:"用户账号",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["username",e.validatorRules.username],expression:"[ 'username', validatorRules.username]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入用户账号",readOnly:!!e.model.id}})],1),e.model.id?e._e():[a("a-form-item",{attrs:{label:"登录密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password"],expression:"[ 'password']"}],attrs:{type:"password",placeholder:"请输入登录密码"}})],1),a("a-form-item",{attrs:{label:"确认密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["confirmpassword",e.validatorRules.confirmpassword],expression:"[ 'confirmpassword', validatorRules.confirmpassword]"}],attrs:{type:"password",placeholder:"请重新输入登录密码"},on:{blur:e.handleConfirmBlur}})],1)],a("a-form-item",{attrs:{label:"用户姓名",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["realname",e.validatorRules.realname],expression:"[ 'realname', validatorRules.realname]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入用户姓名"}})],1),a("a-form-item",{attrs:{label:"工号",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["workNo",e.validatorRules.workNo],expression:"[ 'workNo', validatorRules.workNo]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入工号"}})],1),a("a-form-item",{attrs:{label:"部门分配",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-search",{attrs:{placeholder:"点击选择部门",readOnly:""},on:{search:e.onSearch},model:{value:e.checkedDepartNameString,callback:function(t){e.checkedDepartNameString=t},expression:"checkedDepartNameString"}},[a("a-button",{attrs:{slot:"enterButton",icon:"search"},slot:"enterButton"},[e._v("选择")])],1)],1)],2)],1),a("depart-window",{ref:"departWindow",on:{ok:e.modalFormOk}}),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.disableSubmit,expression:"!disableSubmit"}],staticClass:"drawer-bootom-button"},[a("a-popconfirm",{attrs:{title:"确定放弃编辑？",okText:"确定",cancelText:"取消"},on:{confirm:e.handleCancel}},[a("a-button",{staticStyle:{"margin-right":".8rem"}},[e._v("取消")])],1),a("a-button",{attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.handleSubmit}},[e._v("提交")])],1)],2)},r=[],i=a("88bc"),d=a.n(i),l=a("c1df"),n=a.n(l),o=a("2b0e"),c=a("290e"),u=a("61fc"),h=a("9fb0"),p=a("0fea"),m=a("4ec3"),f=a("c82c"),v=a("e610"),b={name:"UserNewModal",components:{JImageUpload:v["default"],departWindow:c["default"],JSelectPosition:u["default"]},data:function(){return{departDisabled:!1,roleDisabled:!1,modalWidth:800,drawerWidth:700,modaltoggleFlag:!0,confirmDirty:!1,selectedDepartKeys:[],checkedDepartKeys:[],checkedDepartNames:[],checkedDepartNameString:"",resultDepartOptions:[],userId:"",disableSubmit:!1,userDepartModel:{userId:"",departIdList:[]},dateFormat:"YYYY-MM-DD",validatorRules:{username:{rules:[{required:!0,message:"请输入用户账号!"},{validator:this.validateUsername}]},password:{rules:[{required:!0,pattern:/^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+`\-={}:";'<>?,./]).{8,}$/,message:"密码由8位数字、大小写字母和特殊符号组成!"},{validator:this.validateToNextPassword}]},confirmpassword:{rules:[{required:!0,message:"请重新输入登录密码!"},{validator:this.compareToFirstPassword}]},realname:{rules:[{required:!0,message:"请输入用户名称!"}]},phone:{rules:[{validator:this.validatePhone}]},email:{rules:[{validator:this.validateEmail}]},roles:{},workNo:{rules:[{required:!0,message:"请输入工号"},{validator:this.validateWorkNo}]},telephone:{rules:[{pattern:/^0\d{2,3}-[1-9]\d{6,7}$/,message:"请输入正确的座机号码"}]}},departIdShow:!1,departIds:[],title:"操作",visible:!1,model:{},roleList:[],selectedRole:[],labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},uploadLoading:!1,confirmLoading:!1,headers:{},form:this.$form.createForm(this),picUrl:"",url:{fileUpload:window._CONFIG["domianURL"]+"/sys/common/upload",userWithDepart:"/sys/user/userDepartList",userId:"/sys/user/generateUserId",syncUserByUserName:"/process/extActProcess/doSyncUserByUserName",queryTenantList:"/sys/tenant/queryList"},identity:"1",fileList:[],tenantList:[],currentTenant:[]}},created:function(){var e=o["default"].ls.get(h["a"]);this.headers={"X-Access-Token":e},this.initTenantList()},computed:{uploadAction:function(){return this.url.fileUpload}},methods:{isDisabledAuth:function(e){return Object(f["a"])(e)},initTenantList:function(){var e=this;Object(p["d"])(this.url.queryTenantList).then((function(t){t.success&&(e.tenantList=t.result)}))},toggleScreen:function(){this.modaltoggleFlag?this.modalWidth=window.innerWidth:this.modalWidth=800,this.modaltoggleFlag=!this.modaltoggleFlag},initialRoleList:function(){var e=this;Object(m["U"])().then((function(t){t.success&&(e.roleList=t.result)}))},loadUserRoles:function(e){var t=this;Object(m["T"])({userid:e}).then((function(e){e.success&&(t.selectedRole=e.result)}))},refresh:function(){this.selectedDepartKeys=[],this.checkedDepartKeys=[],this.checkedDepartNames=[],this.checkedDepartNameString="",this.userId="",this.resultDepartOptions=[],this.departId=[],this.departIdShow=!1,this.currentTenant=[]},add:function(){this.picUrl="",this.refresh(),this.edit({activitiSync:"1"})},edit:function(e){var t=this;this.resetScreenSize();var a=this;a.initialRoleList(),a.checkedDepartNameString="",a.form.resetFields(),e.hasOwnProperty("id")&&(a.loadUserRoles(e.id),setTimeout((function(){t.fileList=e.avatar}),5)),a.userId=e.id,a.visible=!0,a.model=Object.assign({},e),a.$nextTick((function(){a.form.setFieldsValue(d()(t.model,"username","sex","realname","email","phone","activitiSync","workNo","telephone","post"))})),"2"==this.model.userIdentity?(this.identity="2",this.departIdShow=!0):(this.identity="1",this.departIdShow=!1),a.checkedDepartKeys=[],a.loadCheckedDeparts(),e.relTenantIds&&0!=e.relTenantIds.length?this.currentTenant=e.relTenantIds.split(",").map(Number):this.currentTenant=[]},loadCheckedDeparts:function(){var e=this,t=this;t.userId&&Object(p["d"])(t.url.userWithDepart,{userId:t.userId}).then((function(a){if(t.checkedDepartNames=[],a.success){for(var s=[],r=[],i=0;i<a.result.length;i++)t.checkedDepartNames.push(a.result[i].title),e.checkedDepartNameString=e.checkedDepartNames.join(","),t.checkedDepartKeys.push(a.result[i].key),s.push({key:a.result[i].key,title:a.result[i].title}),r.push(a.result[i].key);t.resultDepartOptions=s,e.model.departIds?e.departIds=e.model.departIds.split(","):e.departIds=r,t.userDepartModel.departIdList=t.checkedDepartKeys}}))},close:function(){this.$emit("close"),this.visible=!1,this.disableSubmit=!1,this.selectedRole=[],this.userDepartModel={userId:"",departIdList:[]},this.checkedDepartNames=[],this.checkedDepartNameString="",this.checkedDepartKeys=[],this.selectedDepartKeys=[],this.resultDepartOptions=[],this.departIds=[],this.departIdShow=!1,this.identity="1",this.fileList=[]},moment:n.a,handleSubmit:function(){var e=this,t=this;this.form.validateFields((function(a,s){if(!a){t.confirmLoading=!0,s.birthday?s.birthday=s.birthday.format(e.dateFormat):s.birthday="";var r,i=Object.assign(e.model,s);""!=t.fileList?i.avatar=t.fileList:i.avatar=null,i.relTenantIds=e.currentTenant.length>0?e.currentTenant.join(","):"",i.selectedroles=e.selectedRole.length>0?e.selectedRole.join(","):"",i.selecteddeparts=e.userDepartModel.departIdList.length>0?e.userDepartModel.departIdList.join(","):"",i.userIdentity=e.identity,"2"===e.identity?i.departIds=e.departIds.join(","):i.departIds="",e.model.id?r=Object(m["r"])(i):(i.id=e.userId,r=Object(m["e"])(i)),r.then((function(e){e.success?(t.$message.success(e.message),t.$emit("ok")):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1,t.checkedDepartNames=[],t.userDepartModel.departIdList={userId:"",departIdList:[]},t.close()}))}}))},handleCancel:function(){this.close()},validateToNextPassword:function(e,t,a){var s=this.form,r=s.getFieldValue("confirmpassword");t&&r&&t!==r&&a("两次输入的密码不一样！"),t&&this.confirmDirty&&s.validateFields(["confirm"],{force:!0}),a()},compareToFirstPassword:function(e,t,a){var s=this.form;t&&t!==s.getFieldValue("password")?a("两次输入的密码不一样！"):a()},validatePhone:function(e,t,a){if(t)if(new RegExp(/^1[3|4|5|7|8|9][0-9]\d{8}$/).test(t)){var s={tableName:"sys_user",fieldName:"phone",fieldVal:t,dataId:this.userId};Object(m["m"])(s).then((function(e){e.success?a():a("手机号已存在!")}))}else a("请输入正确格式的手机号码!");else a()},validateEmail:function(e,t,a){if(t)if(new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(t)){var s={tableName:"sys_user",fieldName:"email",fieldVal:t,dataId:this.userId};Object(m["m"])(s).then((function(e){e.success?a():a("邮箱已存在!")}))}else a("请输入正确格式的邮箱!");else a()},validateUsername:function(e,t,a){var s={tableName:"sys_user",fieldName:"username",fieldVal:t,dataId:this.userId,hasDel:"1"};Object(m["m"])(s).then((function(e){e.success?a():a("用户名已存在!")}))},validateWorkNo:function(e,t,a){var s={tableName:"sys_user",fieldName:"work_no",fieldVal:t,dataId:this.userId};Object(m["m"])(s).then((function(e){e.success?a():a("工号已存在!")}))},handleConfirmBlur:function(e){var t=e.target.value;this.confirmDirty=this.confirmDirty||!!t},normFile:function(e){return Array.isArray(e)?e:e&&e.fileList},beforeUpload:function(e){var t=e.type;if(t.indexOf("image")<0)return this.$message.warning("请上传图片"),!1},handleChange:function(e){if(this.picUrl="","uploading"!==e.file.status){if("done"===e.file.status){var t=e.file.response;this.uploadLoading=!1,t.success?(this.model.avatar=t.message,this.picUrl="Has no pic url yet"):this.$message.warning(t.message)}}else this.uploadLoading=!0},onSearch:function(){this.$refs.departWindow.add(this.checkedDepartKeys,this.userId)},modalFormOk:function(e){this.checkedDepartNames=[],this.selectedDepartKeys=[],this.checkedDepartNameString="",this.userId=e.userId,this.userDepartModel.userId=e.userId,this.departIds=[],this.resultDepartOptions=[];for(var t=[],a=0;a<e.departIdList.length;a++)this.selectedDepartKeys.push(e.departIdList[a].key),this.checkedDepartNames.push(e.departIdList[a].title),this.checkedDepartNameString=this.checkedDepartNames.join(","),t.push({key:e.departIdList[a].key,title:e.departIdList[a].title}),this.departIds.push(e.departIdList[a].key);this.resultDepartOptions=t,this.userDepartModel.departIdList=this.selectedDepartKeys,this.checkedDepartKeys=this.selectedDepartKeys},resetScreenSize:function(){var e=document.body.clientWidth;this.drawerWidth=e<500?e:700},identityChange:function(e){"1"===e.target.value?this.departIdShow=!1:this.departIdShow=!0}}},y=b,g=(a("0228"),a("2877")),w=Object(g["a"])(y,s,r,!1,null,"a0fb77a2",null);t["default"]=w.exports},70999:function(e,t,a){},a02c:function(e,t,a){"use strict";var s=a("2122"),r=a.n(s);r.a}}]);